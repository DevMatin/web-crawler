version: '3.8'

services:
  crawler:
    build: .
    container_name: web-crawler
    command:
      - sh
      - -c
      - |
        if [ -n "$$START_URLS" ]; then
          node dist/main.js
        else
          echo "Crawler Service: START_URLS nicht gesetzt, Ã¼berspringe direkten Crawl. Verwende API-Server."
          sleep infinity
        fi
    environment:
      - START_URLS=${START_URLS:-}
      - ALLOWED_DOMAINS=${ALLOWED_DOMAINS:-}
      - MAX_REQUESTS_PER_CRAWL=${MAX_REQUESTS_PER_CRAWL:-100}
      - MAX_CONCURRENCY=${MAX_CONCURRENCY:-10}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - STORAGE_DIR=/app/storage
    volumes:
      - ./storage:/app/storage
    restart: unless-stopped
    networks:
      - crawler-network

  api:
    build: .
    container_name: web-crawler-api
    command: node dist/api/server.js
    ports:
      - "3000:3000"
    environment:
      - PORT=3000
      - STORAGE_DIR=/app/storage
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_SERVICE_ROLE_KEY=${SUPABASE_SERVICE_ROLE_KEY}
    volumes:
      - ./storage:/app/storage
    restart: unless-stopped
    networks:
      - crawler-network

networks:
  crawler-network:
    driver: bridge

